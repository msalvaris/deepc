FROM deepc/base:p36-cuda9-cudnn7-devel

RUN apt-get update && apt-get install -y --no-install-recommends \
		software-properties-common python-software-properties

RUN apt-get update && apt-get install -y --no-install-recommends \
        openmpi-bin \
        libpng-dev \
        libtiff-dev \
        ca-certificates \
        wget \
        sudo \
		build-essential \
		libjasper-dev && \
    	rm -rf /var/lib/apt/lists/*

ENV KMP_DUPLICATE_LIB_OK TRUE

ENV CNTK_VERSION="2.4"

# Get CNTK Binary Distribution
RUN CNTK_VERSION_DASHED=$(echo $CNTK_VERSION | tr . -) && \
    CNTK_SHA256="8eabc27f91d3ac7a10c6a089f6eab9d019808ac4510e52aee982f61d560df897" && \
    wget -q https://cntk.ai/BinaryDrop/CNTK-${CNTK_VERSION_DASHED}-Linux-64bit-GPU.tar.gz && \
    echo "$CNTK_SHA256 CNTK-${CNTK_VERSION_DASHED}-Linux-64bit-GPU.tar.gz" | sha256sum --check --strict - && \
    tar -xzf CNTK-${CNTK_VERSION_DASHED}-Linux-64bit-GPU.tar.gz && \
    rm -f CNTK-${CNTK_VERSION_DASHED}-Linux-64bit-GPU.tar.gz && \
	/bin/bash /cntk/Scripts/install/linux/install-cntk.sh --py-version 36 --docker



